<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wartungsportal Generatoren</title>
  <style>
    body { font-family: Arial; text-align: center; background: #f4f6f9; margin: 40px; }
    button { display: block; margin: 10px auto; padding: 12px; width: 250px; border-radius: 10px; border: none; background: #4a90e2; color: white; font-size: 16px; cursor: pointer; }
    button:hover { background: #357ABD; }
    input, textarea, select { width: 90%; margin: 8px 0; padding: 8px; }
    .hidden { display: none; }
    #list { background: white; padding: 15px; border-radius: 12px; margin-top: 20px; }
    .entry { border-bottom: 1px solid #ddd; padding: 8px; text-align: left; }
    .status { width: 15px; height: 15px; display: inline-block; margin-left: 8px; border-radius: 3px; }
  </style>
</head>
<body>
  <h1>âš¡ Wartungsportal Generatoren âš¡</h1>

  <button onclick="window.open('https://drive.google.com/file/d/1Pqe6DCpG8WYtwVL_SeYGbe1bWGzqlgUy/view?usp=drive_link','_blank')">ðŸ“„ Wartungsanleitung</button>
  <button onclick="window.open('https://docs.google.com/spreadsheets/d/1u8ANnoSeVywqraNGXkbxUezFOaSEBEV0T8scEwqnV2o/edit?gid=0#gid=0/edit','_blank')">ðŸ“Š Protokoll</button>
  <button onclick="toggle('form')">âš  Zwischenfall erfassen</button>
  <button onclick="loadIncidents()">ðŸ“‹ ZwischenfÃ¤lle</button>
  <button onclick="toggle('closeForm')">âœ… Zwischenfall schlieÃŸen</button>

  <!-- Erfassen -->
  <div id="form" class="hidden">
    <h3>Zwischenfall erfassen</h3>
    <input id="inventar" placeholder="Inventar Nr.">
    <input id="art" placeholder="Art des Zwischenfalls">
    <textarea id="beschreibung" placeholder="Beschreibung"></textarea>
    <button onclick="addIncident()">Absenden</button>
  </div>

  <!-- SchlieÃŸen -->
  <div id="closeForm" class="hidden">
    <h3>Zwischenfall schlieÃŸen</h3>
    <input id="closeInventar" placeholder="Inventar Nr.">
    <input id="closeArt" placeholder="Art des Zwischenfalls">
    <textarea id="closeBeschreibung" placeholder="Abschluss-Beschreibung"></textarea>
    <input id="visum" placeholder="Visum (Name)">
    <button onclick="closeIncident()">SchlieÃŸen</button>
  </div>

  <!-- Liste -->
  <div id="list" class="hidden">
    <h3>ZwischenfÃ¤lle</h3>
    <div id="entries"></div>
  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwXD23MjAOOEpNocTeSvmvoosoBmiAt8TMzbOr-R-E1nkVA7wiMcgzszWi7yIjJvCWWmg/exec"; // Google Script

function toggle(id) {
  document.getElementById('form').classList.add('hidden');
  document.getElementById('closeForm').classList.add('hidden');
  document.getElementById('list').classList.add('hidden');
  if (id) document.getElementById(id).classList.remove('hidden');
}

async function addIncident() {
  const data = {
    inventar: document.getElementById('inventar').value,
    art: document.getElementById('art').value,
    beschreibung: document.getElementById('beschreibung').value
  };
  await fetch(API_URL, {method:"POST", body:JSON.stringify(data)});
  alert("âœ… Zwischenfall erfasst!");
  toggle('');
}

async function loadIncidents() {
  toggle('list');
  const res = await fetch(API_URL);
  const data = await res.json();
  const container = document.getElementById('entries');
  container.innerHTML = "";
  data.forEach(inc => {
    let div = document.createElement("div");
    div.className = "entry";
    let statusBox = `<span class="status" style="background:${inc.Status==="geschlossen"?"green":"red"}"></span>`;
    let visum = inc.Status==="geschlossen" ? ` | Visum: ${inc.Visum} <button onclick="alert('${inc['Abschluss-Beschreibung']}')">Details</button>` : "";
    div.innerHTML = `${inc.Art} | Inventar: ${inc.Inventar} ${visum} ${statusBox}`;
    container.appendChild(div);
  });
}

async function closeIncident() {
  const data = {
    inventar: document.getElementById('closeInventar').value,
    art: document.getElementById('closeArt').value,
    closeBeschreibung: document.getElementById('closeBeschreibung').value,
    visum: document.getElementById('visum').value
  };
  await fetch(API_URL + "?action=closeIncident", {method:"POST", body:JSON.stringify(data)});
  alert("âœ… Zwischenfall geschlossen!");
  toggle('');
}
</script>
</body>
</html>
